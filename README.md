# 🤖 AI Smarttalk React Hooks

[![Tests](https://github.com/AI-SmartTalk/aismarttalk-react-hooks/actions/workflows/test.yml/badge.svg)](https://github.com/AI-SmartTalk/aismarttalk-react-hooks/actions/workflows/test.yml)
[![codecov](https://codecov.io/gh/AI-SmartTalk/aismarttalk-react-hooks/branch/main/graph/badge.svg)](https://codecov.io/gh/AI-SmartTalk/aismarttalk-react-hooks)
[![npm version](https://img.shields.io/npm/v/@aismarttalk/react-hooks.svg)](https://www.npmjs.com/package/@aismarttalk/react-hooks)
[![License](https://img.shields.io/github/license/AI-SmartTalk/aismarttalk-react-hooks)](https://github.com/AI-SmartTalk/aismarttalk-react-hooks/blob/main/LICENSE)

A collection of high-quality, reusable React hooks for integrating [AI Smarttalk](https://aismarttalk.tech)'s [AI Agents](https://aismarttalk.tech) into your React application. This library provides hooks for managing chat messages, user state, and chat instance initialization with robust error handling, token validation, and localStorage persistence.

---

## ✨ Features

### 💬 Chat Interface for the AI Agent

- 🔄 Manage chat messages, WebSocket connections, typing notifications, and conversation history with a flexible configuration
- 👤 Handle user state with localStorage persistence, token validation (JWT), and automatic fallback to an anonymous user if needed
- 🚀 Initialize or reset a chat instance based on a given chat model and language, using API calls to create new instances when required

### 📝 Canvas System
The library includes a powerful canvas system for handling structured text content (like code or documents):

- 🤝 **Real-time collaborative text editing** with automatic synchronization across all connected clients
- ✍️ **Line-by-line manipulation** with support for inserting, updating, and deleting lines
- 📚 **History tracking** with localStorage persistence
- 🔢 **Formatted output** with line numbers for AI interactions
- 🔄 **Simple text conversion** for easy integration with LLMs

#### Example usage:
```tsx
const ChatComponent = () => {
  const {
    messages,
    canvasHistory, // Access the canvas system
    // ... other chat features
  } = useAISmarttalkChat({
    chatModelId: 'your-model-id',
    lang: 'en',
    config: {
      apiUrl: 'https://aismarttalk.tech',
      wsUrl: 'wss://ws.223.io.aismarttalk.tech',
      apiToken: 'your-api-token',
    },
  });

  // Store code generated by AI
  const handleAICode = (code: string[]) => {
    canvasHistory.updateCanvas({
      title: "Generated Code",
      content: code
    });
  };

  // Get formatted code with line numbers for AI context
  const getNumberedCode = () => {
    return canvasHistory.getNumberedLines();
  };

  // Update specific lines
  const updateLine = (lineNumber: number, newContent: string) => {
    canvasHistory.updateLineRange(lineNumber, lineNumber, [newContent]);
  };

  return (
    // Your chat UI implementation
  );
};
```

The canvas system maintains synchronization across all connected clients automatically through WebSocket events, making it perfect for collaborative code review and document editing scenarios.

---

## 🚀 Installation

Install the package via npm or yarn:

```bash
npm install @aismarttalk/react-hooks
# or
yarn add @aismarttalk/react-hooks
```

> 💡 _Note: Replace `@aismarttalk/react-hooks` with the actual package name if different._

---

## 🏁 Getting Started

### Using `useAiSmarttalkChat`

```tsx
import { useAISmarttalkChat } from '@aismarttalk/react-hooks';

const ChatComponent = () => {
  const {
    messages,
    addMessage,
    user,
    setUser,
    chatInstanceId,
    resetChat,
    socketStatus,
    error,
    // ... and more
  } = useAISmarttalkChat({
    chatModelId: 'your-model-id',
    lang: 'en',
    config: {
      apiUrl: 'https://aismarttalk.tech',
      wsUrl: 'wss://ws.223.io.aismarttalk.tech',
      apiToken: 'your-api-token',
    },
  });

  return (
    // Your chat UI implementation
  );
};
```

### Using `useChatInstance`

```tsx
import React from 'react';
import useChatInstance from '@aismarttalk/react-hooks/hooks/useChatInstance';

const ChatInstanceComponent = () => {
  const { chatInstanceId, resetInstance, error } = useChatInstance({
    chatModelId: 'your-model-id',
    lang: 'en',
    config: {
      apiUrl: 'https://aismarttalk.tech',
      apiToken: 'your-api-token',
    },
    user: { token: 'user-token' },
  });

  return (
    <div>
      {error && <p style={{ color: 'red' }}>{error.message}</p>}
      <h3>Chat Instance ID: {chatInstanceId}</h3>
      <button onClick={resetInstance}>Reset Chat Instance</button>
    </div>
  );
};

export default ChatInstanceComponent;
```

## 📝 Changelog

### 1.2.1 - Fix Regression
- 🐛 Fixed regression where suggestions were not being returned from useAISmarttalkChat hook
- 🔄 Restored suggestions functionality to maintain expected behavior
- ✅ Added additional validation to prevent future regressions

### 1.2.0 - Canvas System Update
- ✨ Added canvas system for structured text handling
- 🔄 Real-time collaborative editing support
- 📚 Local history tracking
- 🔢 Line number formatting utilities

### 1.1.1 - 1.1.3 - Maintenance
- 🐛 Fix hardcoded urls in getChatModel
- 🧹 Refactor and remove duplicated code

### 1.1.0 - Major Update
- 🎉 Introducing consolidated `useAISmarttalkChat` hook
- 📦 Simplified integration with reduced boilerplate
- 🔧 Enhanced TypeScript support
- ⚡ Improved performance

---

## 📄 License

This project is licensed under the [Apache 2.0 Licence](LICENSE).

---

## 📞 Contact

For questions or support, please [open an issue](../../issues) on the repository or contact the maintainer.

---

## 🌟 Contributing

We welcome contributions! Please feel free to submit a Pull Request.

---

Enjoy integrating chat functionality with [AI Smarttalk](https://aismarttalk.tech) React Hooks! 🚀